<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>Nash Mvp</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="./img/nash.ico">

    <script src="./js/vue.js"></script>
    <!-- 生产环境版本，优化了尺寸和速度 -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
    <!-- web3 -->
    <script src="./js/web3.min.js"></script>
    <!-- <script src="https://cdn.bootcdn.net/ajax/libs/web3/1.2.8/web3.min.js"></script> -->

    <script language="javascript" type="text/javascript" src="./js/API_NAP_MVP.js"></script>
    <!-- TODO:产品环境使用cdn链接 -->
    <script src="./js/jquery.min.js"></script>
    <!-- <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script> -->
    <script src="./js/popper.min.js"></script>
    <!-- <script src="https://cdn.bootcdn.net/ajax/libs/popper.js/1.13.0-next.1/esm/popper.min.js"></script> -->
    <script src="./js/bootstrap.min.js"></script>
    <!-- <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script> -->
    <script src="./js/clipboard.min.js"></script>
    <!-- <script src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script> -->
    <script src="./js/cytoscape.min.js"></script>
    <!-- <script src="https://cdn.bootcdn.net/ajax/libs/cytoscape/3.17.1/cytoscape.esm.min.js"></script> -->
    <script src="./js/cytoscape-cxtmenu.js"></script>

    <!-- css -->
    <link rel="stylesheet" href="./css/bootstrap.min.css" crossorigin="anonymous">
    <!-- <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" rel="stylesheet"> -->
    <link type="text/css" rel="styleSheet" href="./css/neon.css" />

    <!-- 强制刷新免遗留 -->
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="expires" content="0">

</head>

<style scoped>
    body {
        padding: 1vh;
        background-color: #111;
        overflow-x: hidden;
    }

    svg,
    canvas {
        text-align: center;
        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;
        position: fixed;
        width: 100%;
        height: 100%;
    }
</style>

<body bgcolor="#E6E6FA">
    <script src='./js/trianglify.bundle.js'></script>
    <script>
        var pattern = trianglify({
            width: window.innerWidth,
            height: window.innerHeight
        })
        document.body.appendChild(pattern.toCanvas())
    </script>


    <canvas id="stars">
        <h1>
            区块链连接中
        </h1>
    </canvas>
    <script>
        const STAR_COUNT = (window.innerWidth + window.innerHeight) / 8,
            STAR_SIZE = 3,
            STAR_MIN_SCALE = 0.2,
            OVERFLOW_THRESHOLD = 50;

        const canvas = document.querySelector('#stars'),
            context = canvas.getContext('2d');

        let scale = 1, // device pixel ratio
            width,
            height;

        let stars = [];

        let pointerX,
            pointerY;

        let velocity = { x: 0, y: 0, tx: 0, ty: 0, z: 0.0005 };

        let touchInput = false;

        generate();
        resize();
        step();

        window.onresize = resize;
        window.onmousemove = onMouseMove;
        window.ontouchmove = onTouchMove;
        window.ontouchend = onMouseLeave;
        document.onmouseleave = onMouseLeave;

        function generate() {

            for (let i = 0; i < STAR_COUNT; i++) {
                stars.push({
                    x: 0,
                    y: 0,
                    z: STAR_MIN_SCALE + Math.random() * (1 - STAR_MIN_SCALE)
                });
            }

        }

        function placeStar(star) {

            star.x = Math.random() * width;
            star.y = Math.random() * height;

        }

        function recycleStar(star) {

            let direction = 'z';

            let vx = Math.abs(velocity.x),
                vy = Math.abs(velocity.y);

            if (vx > 1 || vy > 1) {
                let axis;

                if (vx > vy) {
                    axis = Math.random() < vx / (vx + vy) ? 'h' : 'v';
                }
                else {
                    axis = Math.random() < vy / (vx + vy) ? 'v' : 'h';
                }

                if (axis === 'h') {
                    direction = velocity.x > 0 ? 'l' : 'r';
                }
                else {
                    direction = velocity.y > 0 ? 't' : 'b';
                }
            }

            star.z = STAR_MIN_SCALE + Math.random() * (1 - STAR_MIN_SCALE);

            if (direction === 'z') {
                star.z = 0.1;
                star.x = Math.random() * width;
                star.y = Math.random() * height;
            }
            else if (direction === 'l') {
                star.x = -OVERFLOW_THRESHOLD;
                star.y = height * Math.random();
            }
            else if (direction === 'r') {
                star.x = width + OVERFLOW_THRESHOLD;
                star.y = height * Math.random();
            }
            else if (direction === 't') {
                star.x = width * Math.random();
                star.y = -OVERFLOW_THRESHOLD;
            }
            else if (direction === 'b') {
                star.x = width * Math.random();
                star.y = height + OVERFLOW_THRESHOLD;
            }

        }

        function resize() {

            scale = window.devicePixelRatio || 1;

            width = window.innerWidth * scale;
            height = window.innerHeight * scale;

            canvas.width = width;
            canvas.height = height;

            stars.forEach(placeStar);

        }

        function step() {

            context.clearRect(0, 0, width, height);

            update();
            render();

            requestAnimationFrame(step);

        }

        function update() {

            velocity.tx *= 0.96;
            velocity.ty *= 0.96;

            velocity.x += (velocity.tx - velocity.x) * 0.8;
            velocity.y += (velocity.ty - velocity.y) * 0.8;

            stars.forEach((star) => {

                star.x += velocity.x * star.z;
                star.y += velocity.y * star.z;

                star.x += (star.x - width / 2) * velocity.z * star.z;
                star.y += (star.y - height / 2) * velocity.z * star.z;
                star.z += velocity.z;

                // recycle when out of bounds
                if (star.x < -OVERFLOW_THRESHOLD || star.x > width + OVERFLOW_THRESHOLD || star.y < -OVERFLOW_THRESHOLD || star.y > height + OVERFLOW_THRESHOLD) {
                    recycleStar(star);
                }

            });

        }
        function rdm() {
            return String(Math.floor(Math.random() * 256) + ',');
        }
        function render() {

            stars.forEach((star) => {

                context.beginPath();
                context.lineCap = 'round';
                context.lineWidth = STAR_SIZE * star.z * scale;
                context.strokeStyle = 'rgba(255,255,255,' + (0.5 + 0.5 * Math.random()) + ')';
                // context.strokeStyle = 'rgba('+rdm()+rdm()+rdm()+(0.5 + 0.5*Math.random())+')';
                // context.strokeText = "Hello World!";
                context.beginPath();
                context.moveTo(star.x, star.y);

                var tailX = velocity.x * 2,
                    tailY = velocity.y * 2;

                // stroke() wont work on an invisible line
                if (Math.abs(tailX) < 0.1) tailX = 0.5;
                if (Math.abs(tailY) < 0.1) tailY = 0.5;

                context.lineTo(star.x + tailX, star.y + tailY);

                context.stroke();

            });

        }

        function movePointer(x, y) {

            if (typeof pointerX === 'number' && typeof pointerY === 'number') {

                let ox = x - pointerX,
                    oy = y - pointerY;

                velocity.tx = velocity.tx + (ox / 8 * scale) * (touchInput ? 1 : -1);
                velocity.ty = velocity.ty + (oy / 8 * scale) * (touchInput ? 1 : -1);

            }

            pointerX = x;
            pointerY = y;

        }

        function onMouseMove(event) {

            touchInput = false;

            movePointer(event.clientX, event.clientY);

        }

        function onTouchMove(event) {

            touchInput = true;

            movePointer(event.touches[0].clientX, event.touches[0].clientY, true);

            event.preventDefault();

        }

        function onMouseLeave() {

            pointerX = null;
            pointerY = null;

        }
    </script>
    <div id="app" style="width: 100%;">

        <div id="element" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-delay="10000"
            style="position: absolute;right: 1rem;z-index: 2;">
            <div class="toast-header">
                <img src="./img/nash.ico" class="rounded mr-2" alt="NASH icon" style="width: 1rem;height: 1rem;">
                <strong class="mr-auto" style="padding-right: 1rem;">{{toastTitle}}</strong>
                <small> @{{timeNow}}</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body" style="white-space: pre-line;">{{toastContent}}
            </div>
        </div>
        <header>
            <div class="card">
                <div class="card-body">
                    <span>
                        <span class="neon" onclick="location.reload();"> <img src="./img/nash.ico">N✌A✊S✋H - #0</span>
                    </span>
                    <span style="float: right;">
                        <a style="float: right;">Total Supply: {{TotalSupply}} $NAP </a><br>
                        <a style="float: right;">BlockNumber: {{BlockNumber}}</a><br>
                        <a :href="`https://${blockExplorer[netWork]}/address/`+ NAPAddress"
                            target="_blank">📡{{netWork}}</a>
                        <a class="btn btn-danger btn-sm" target="_blank" style="float: right;"
                            href="https://www.yuque.com/books/share/f2a34eb8-6ab2-418a-9a04-7a275af66a4c?#"
                            role="button">Learn More🚀</a>
                    </span>
                </div>
            </div>
        </header>
        <br>
        <div v-if="NAPContract == undefined">
        </div>
        <div v-else>
            <div class="row">
                <div class="col-3" style="min-width: 13rem;">
                    <aside>
                        <div class="card">
                            <div class="card-body">
                                <div class="modal fade " id="staticBackdropCreateOracle" data-backdrop="static"
                                    data-keyboard="false" tabindex="-1" role="dialog"
                                    aria-labelledby="staticBackdropLabel" aria-hidden="true" style=";">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="staticBackdropLabel">
                                                    Create Oracle And Set Encrypted Strategy</h5>
                                                <button type="button" class="close" data-dismiss="modal"
                                                    aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <span class="btn-group mr-2" style="width: 100%;margin-bottom: 5px;"
                                                    role="group" aria-label="First group">
                                                    <button type="button" class="btn btn-warning neon"
                                                        @click='oracle_myStrategy=1'>✌</button>
                                                    <button type="button" class="btn btn-success neon"
                                                        @click='oracle_myStrategy=2'>✊</button>
                                                    <button type="button" class="btn btn-primary neon"
                                                        @click='oracle_myStrategy=3'>✋</button>
                                                </span>
                                                <input class="input-group-text" style="width: 100%;margin-bottom: 5px;"
                                                    type="text" placeholder='Entropy for encryption'
                                                    v-model='oracle_create_rawEntropy'></input>
                                                <input class="input-group-text" style="width: 100%;margin-bottom: 5px;"
                                                    type="number" placeholder='waitBlocks (default is 4000)' step='10'
                                                    v-model='oracle_create_waitblocks'></input>
                                                <input class="input-group-text" style="width: 100%;margin-bottom: 5px;"
                                                    type="number" :placeholder="'$' + coinName[netWork] + ' JoinFees'"
                                                    step='0.1' v-model='oracle_create_joinfee'></input>
                                                <input class="input-group-text" style="width: 100%;margin-bottom: 5px;"
                                                    type="number" placeholder='$NAP Bid(default is 0)'
                                                    v-model='oracle_create_bidFee'></input>
                                                <small v-if="(oracle_create_joinfee !='')&(oracle_create_bidFee !='')"
                                                    style="text-align: center;display: block;">
                                                    【{{oracle_create_bidFee/(oracle_create_joinfee*0.95)}}
                                                    $NAP/${{coinName[netWork]}}】
                                                    <br>
                                                    【{{(oracle_create_joinfee*0.95)/oracle_create_bidFee}}
                                                    ${{coinName[netWork]}}/$NAP】
                                                </small>

                                            </div>
                                            <div class="modal-footer">
                                                <div v-if='showAlertAtOracleCreate' style="width: 100%;"
                                                    class="alert alert-danger" role="alert">
                                                    {{alertAtOracleCreate}}
                                                </div>
                                                <div v-if='!showAlertAtOracleCreate' style="width: 100%;"
                                                    class="alert alert-success" role="alert">
                                                    {{alertAtOracleCreate}}
                                                </div>
                                                <a href="#" style="width: 100%;" class="btn btn-info"
                                                    @click="createOracleAndSetHashStg()">Create Oracle</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="btn-group btn-group-toggle" data-toggle="buttons" style="width: 100%;">
                                    <label class="btn btn-secondary active" @click="oracleMenu = true">
                                        <input type="radio" name="options" id="option1" checked> Oracles
                                    </label>
                                    <label class="btn btn-secondary" @click="oracleMenu = false">
                                        <input type="radio" name="options" id="option2"> Logs
                                    </label>
                                </div>
                                <hr>
                                <span v-if='oracleMenu'>
                                    <button style="width: 100%;margin-bottom: 5px;" type="button"
                                        class="btn btn-success" data-toggle="modal"
                                        data-target="#staticBackdropCreateOracle"
                                        @click='(updateAlertInOracleCreate(false, "Please select a strategy and full form."))'>
                                        Create Oracle
                                    </button>
                                    <!-- <hr> -->
                                    <h5 class="card-title">Lobby:</h5>
                                    <a href="#" style="width: 100%;" class="btn btn-warning"
                                        @click='getJoinAbleOracles()'>
                                        {{classificationTexts[0]}}</a>
                                    <!-- <hr> -->
                                    <h5 class="card-title">My Created:</h5>
                                    <a href="#" style="width: 100%;margin-bottom: 5px;" class="btn btn-primary"
                                        @click='getMyCreateWaitJoin()'>
                                        {{classificationTexts[1]}}</a>
                                    <a href="#" style="width: 100%;margin-bottom: 5px;" class="btn btn-danger"
                                        @click='getMyCreateWaitAnneal()'>
                                        {{classificationTexts[2]}}</a>
                                    <!-- <hr> -->
                                    <h5 class="card-title">My Joined:</h5>
                                    <a href="#" style="width: 100%;margin-bottom: 5px;" class="btn btn-dark"
                                        @click='getMyJoinedWaitAnneal()'>
                                        {{classificationTexts[3]}}</a>
                                </span>
                                <span v-else>

                                    <h5 class="card-title">My Oracles:</h5>
                                    <button style="width: 100%;margin-bottom: 5px;" type="button"
                                        class="btn btn-success" @click='getMyCreateLogs'>
                                        My Created
                                    </button>
                                    <button style="width: 100%;margin-bottom: 5px;" type="button"
                                        class="btn btn-success" @click='getMyJoinedLogs'>
                                        My Joined
                                    </button>
                                    <button style="width: 100%;margin-bottom: 5px;" type="button"
                                        class="btn btn-success" @click='getMyWonLogs'>
                                        My Won
                                    </button>
                                    <hr>
                                    <h5 class="card-title">All Oracles:</h5>
                                    <!-- *Last 10000 Blocks -->
                                    <button style="width: 100%;margin-bottom: 5px;" type="button"
                                        class="btn btn-success" @click='getReCrLogs'>
                                        Recently Created
                                    </button>
                                    <button style="width: 100%;margin-bottom: 5px;" type="button"
                                        class="btn btn-success" @click='getReJnLogs'>
                                        Recently Joined
                                    </button>
                                    <button style="width: 100%;margin-bottom: 5px;" type="button"
                                        class="btn btn-success" @click='getReOvLogs'>
                                        Recently Over
                                    </button>
                                    <button style="width: 100%;margin-bottom: 5px;" type="button"
                                        class="btn btn-success" @click='getReCcd'>
                                        Recently Canceled
                                    </button>
                                    <!-- 
                                    <hr>
                                    <h5 class="card-title">LocalStorage</h5>
                                    <button style="width: 100%;margin-bottom: 5px;" type="button" disabled
                                        class="btn btn-success" @click=''>
                                        My encryption args
                                    </button> -->
                                </span>
                            </div>
                        </div>
                    </aside>
                </div>
                <!-- Oracle Menu -->
                <div v-if="oracleMenu" class="col-9" style="min-width: 23rem;">
                    <section>
                        <div class="card" style="min-height: 20rem;max-height: 30rem;overflow: auto;">
                            <div class="card-body">
                                <div style="display:inline-block;width: 100%;">
                                    <span style="float:right;margin-top: 0.4rem;"> ~ #{{parseInt(oracle_filter_IdStart)
                                        +
                                        9}}</span>
                                    <input class="input-group-text" style="width: 30%;margin-bottom: 5px;float: right;"
                                        type="number" placeholder='OracleID >= (default is 1)'
                                        v-model='oracle_filter_IdStart' step='10'>
                                    </input>
                                    <span style="float: right;margin-top: 0.4rem;">
                                        OracleID Filter: #
                                    </span>
                                    <h5 class="card-title">{{classificationTexts[cfBtnNumber]}} </h5>
                                    <!-- <span class="card-text">
                                        {{classificationTexts[cfBtnNumber]}} Oracles：
                                    </span> -->
                                    <!-- <hr> -->
                                    <!-- <span style="float: right;">
                                        Limits:
                                        <div class="btn-group mr-2" role="group" aria-label="First group">
                                            <button type="button" class="btn btn-success"
                                                @click="LimitsReturn=10">10</button>
                                            <button type="button" class="btn btn-primary"
                                                @click="LimitsReturn=20">20</button>
                                            <button type="button" class="btn btn-warning"
                                                @click="LimitsReturn=40">40</button>
                                            <button type="button" class="btn btn-secondary"
                                                @click="LimitsReturn=80">80</button>
                                        </div>
                                    </span> -->
                                </div>
                                <hr>
                                <div class="modal fade " id="staticBackdropJoinOracle" data-backdrop="static"
                                    data-keyboard="false" tabindex="-1" role="dialog"
                                    aria-labelledby="staticBackdropLabel" aria-hidden="true" style=";">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="staticBackdropLabel">Join Oracle
                                                    #{{joiningOracleID}}</h5>
                                                <button type="button" class="close" data-dismiss="modal"
                                                    aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="alert alert-primary" role="alert"
                                                    style="text-align: center;display: block;">
                                                    <small> | 🏆Prize:
                                                        {{joiningOraclePrize}}{{coinName[netWork]}}</small>
                                                    <small> | 💴JoinFee:
                                                        {{w3.utils.fromWei(joiningOracleJoinFee)}}{{coinName[netWork]}}
                                                        |
                                                    </small>
                                                    <br>
                                                    <small> | 💡Create@: {{joiningOracleCreateAt}} | </small>
                                                    <small>⏳WaitBlocks: {{joiningOracleWaitBlock}} | </small>
                                                </div>
                                                <span class="btn-group mr-2" style="width: 100%;margin-bottom: 5px;"
                                                    role="group" aria-label="First group">
                                                    <button type="button" class="btn btn-warning neon"
                                                        @click='oracle_myStrategy=1'>✌</button>
                                                    <button type="button" class="btn btn-success neon"
                                                        @click='oracle_myStrategy=2'>✊</button>
                                                    <button type="button" class="btn btn-primary neon"
                                                        @click='oracle_myStrategy=3'>✋</button>
                                                </span>
                                                <input class="input-group-text" style="width: 100%;margin-bottom: 5px;"
                                                    type="number" placeholder="$NAP Bid(default is 0)"
                                                    v-model='oracle_joing_bidFee'></input>
                                                <small v-if="(oracle_join_joinfee !='')&(oracle_joing_bidFee !='')"
                                                    style="text-align: center;display: block;">
                                                    【{{oracle_joing_bidFee/(oracle_join_joinfee*0.95)}}
                                                    $NAP/${{coinName[netWork]}}】
                                                    <br>
                                                    【{{(oracle_join_joinfee*0.95)/oracle_joing_bidFee}}
                                                    ${{coinName[netWork]}}/$NAP】
                                                </small>

                                            </div>
                                            <div class="modal-footer">
                                                <div v-if='showAlertAtOracleCreate' style="width: 100%;"
                                                    class="alert alert-danger" role="alert">
                                                    {{alertAtOracleCreate}}
                                                </div>
                                                <div v-if='!showAlertAtOracleCreate' style="width: 100%;"
                                                    class="alert alert-success" role="alert">
                                                    {{alertAtOracleCreate}}
                                                </div>
                                                <a href="#" style="width: 100%;" class="btn btn-info"
                                                    @click="joinOracleAndSetGoteRawStg(joiningOracleID)">Join Oracle</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="display:inline-block;width: 100%;">

                                    <div v-for="oracleData in OracleDatas" class="card"
                                        style="width: 18rem;float: left;">
                                        <div class="card-body">
                                            <h5 class="card-title">OracleID : #{{oracleData.OracleID}}<a class="toCopy"
                                                    style="cursor: pointer;"
                                                    :data-clipboard-text="'My 【OracleID is #' + oracleData.OracleID + '】Let\'s have a showdown'">📑</a>
                                            </h5>
                                            <p class="card-text">
                                            <div class="container">
                                                <div class="row">
                                                    <div class="col">
                                                        {{w3.utils.fromWei(oracleData.joinFee,
                                                        'ether')}}{{coinName[netWork]}}
                                                    </div>
                                                    <div class="col">{{fingers[oracleData.myUintInTheOracle]}}</div>
                                                    <div class="w-100"></div>
                                                    <div class="col">waitBlocks : {{oracleData.waitBlocks}}</div>
                                                    <div class="w-100"></div>
                                                    <!-- TODO:根据筛选情况显示，大厅应该是建立时区块高度。其他是对应的过期高度 -->
                                                    <div class="col">{{filterText[FilterState]}}
                                                        {{oracleData.markBlock}}</div>
                                                </div>
                                            </div>
                                            </p>
                                            <a v-if="(MyState == 0)&(FilterState == 1)" href="#" style='float: right;position: absolute;
                                                    right: 1rem;
                                                    bottom: 1rem;' class="btn btn-success btn-sm" data-toggle="modal"
                                                data-target="#staticBackdropJoinOracle"
                                                @click='joinButtonClick(oracleData)'>Join</a>
                                            <a v-if="(MyState == 201)&(FilterState == 1)" href="#" style='float: right;position: absolute;
                                                    right: 1rem;
                                                    bottom: 1rem;' class="btn btn-danger btn-sm"
                                                @click='cancelButtonClick(oracleData)'>Cancel</a>
                                            <a v-if="(MyState == 201)&(FilterState == 2)" href="#" style='float: right;position: absolute;
                                                    right: 1rem;
                                                    bottom: 1rem;' class="btn btn-danger btn-sm" data-toggle="modal"
                                                data-target="#staticBackdropAnnealOracle"
                                                @click='annealButtonClick(oracleData)'>Anneal</a>
                                            <!-- &(oracleData.markBlock < BlockNumber) -->
                                            <a v-if="(MyState == 4)&(FilterState == 2)"
                                                :class="{'disabled': oracleData.markBlock > BlockNumber}" href="#"
                                                style='float: right;position: absolute;
                                                    right: 1rem;
                                                    bottom: 1rem;' class="btn btn-dark btn-sm"
                                                @click='expiredButtonClick(oracleData)'>Finish</a>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <!-- Oracle logs -->
                <div v-else class="col-9" style="min-width: 23rem;">
                    <section>
                        <div class="card" style="min-height: 20rem; max-height: 38rem;overflow: auto;">
                            <div class="card-body">
                                <span v-if="logsType == 1">
                                    <div v-for="olog in OracleLogs" class="alert alert-success" role="alert">
                                        You created 【#{{olog.returnValues.OracleID}}】 oracle at
                                        blockNumber:{{olog.blockNumber}}
                                        【JoinFee:{{w3.utils.fromWei(String(olog.returnValues.JoinFee),'ether')}}${{coinName[netWork]}}】.
                                        【WatiBlock:{{olog.returnValues.WaitBlocks}}】.【Encrypted Strategy :
                                        {{olog.returnValues.stgHash}}】
                                        <a :href="`https://${blockExplorer[netWork]}/tx/`+olog.transactionHash"
                                            target="_blank">↗</a>
                                    </div>
                                </span>
                                <span v-if="logsType == 2">
                                    <div v-for="olog in OracleLogs" class="alert alert-success" role="alert">
                                        You joined 【#{{olog.returnValues.OracleID}}】 oracle at
                                        blockNumber:{{olog.blockNumber}}
                                        【Your
                                        bid:{{w3.utils.fromWei(String(olog.returnValues.GoteOracleBid),'ether')}}】.
                                        【Your Strategy:{{fingers[olog.returnValues.Strategy_Raw]}}】
                                        <a :href="`https://${blockExplorer[netWork]}/tx/`+olog.transactionHash"
                                            target="_blank">↗</a>
                                    </div>
                                </span>
                                <span v-if="logsType == 3">
                                    <div v-for="olog in OracleLogs" class="alert alert-success" role="alert">
                                        【😁:You Win🎉!】 Oracle【#{{olog.returnValues.OracleID}}】
                                        【🏆:{{w3.utils.fromWei(String(olog.returnValues.Prize),
                                        'ether')}}${{coinName[netWork]}}】.【InitStg:{{fingers[olog.returnValues.Strategy_Init]}}】.【GoteStg:{{fingers[olog.returnValues.Strategy_Gote]}}】.【OraclePrice:{{parseFloat(String(2
                                        * olog.returnValues.ValidBid /
                                        olog.returnValues.Prize)).toLocaleString()}}$NAP/${{coinName[netWork]}}】.【OverReason:{{oracle_overReason[olog.returnValues.Reason]}}】
                                        <a :href="`https://${blockExplorer[netWork]}/tx/`+olog.transactionHash"
                                            target="_blank">↗</a>
                                    </div>
                                </span>
                                <span v-if="logsType == 4">
                                    <div v-for="olog in OracleLogs" class="alert alert-success" role="alert">
                                        【#{{olog.returnValues.OracleID}}】oracle created by
                                        【{{olog.returnValues.Creater}}】at blockNumber:{{olog.blockNumber}}
                                        【JoinFee:{{w3.utils.fromWei(String(olog.returnValues.JoinFee),'ether')}}${{coinName[netWork]}}】.
                                        【WatiBlock:{{olog.returnValues.WaitBlocks}}】.【Encrypted Strategy :
                                        {{olog.returnValues.stgHash}}】
                                        <a :href="`https://${blockExplorer[netWork]}/tx/`+olog.transactionHash"
                                            target="_blank">↗</a>
                                    </div>
                                </span>
                                <span v-if="logsType == 5">
                                    <div v-for="olog in OracleLogs" class="alert alert-success" role="alert">
                                        【{{olog.returnValues.Player}}】 joined 【#{{olog.returnValues.OracleID}}】 oracle
                                        at
                                        blockNumber:{{olog.blockNumber}}
                                        【
                                        Bid $NAP:{{w3.utils.fromWei(String(olog.returnValues.GoteOracleBid),'ether')}}】.
                                        The Strategy:{{fingers[olog.returnValues.Strategy_Raw]}}】
                                        <a :href="`https://${blockExplorer[netWork]}/tx/`+olog.transactionHash"
                                            target="_blank">↗</a>
                                    </div>
                                </span>
                                <span v-if="logsType == 6">
                                    <div v-for="olog in OracleLogs" class="alert alert-success" role="alert">
                                        【#{{olog.returnValues.OracleID}}】Oracle
                                        Annealed @{{olog.blockNumber}}【Winner🎉:{{olog.returnValues.Winner}}】.
                                        【🏆:{{w3.utils.fromWei(String(olog.returnValues.Prize),
                                        'ether')}}${{coinName[netWork]}}】.【InitStg:{{fingers[olog.returnValues.Strategy_Init]}}】.【GoteStg:{{fingers[olog.returnValues.Strategy_Gote]}}】.【OraclePrice:{{parseFloat(String(2
                                        * olog.returnValues.ValidBid /
                                        olog.returnValues.Prize)).toLocaleString()}}$NAP/${{coinName[netWork]}}】.【OverReason:{{oracle_overReason[olog.returnValues.Reason]}}】
                                        <a :href="`https://${blockExplorer[netWork]}/tx/`+olog.transactionHash"
                                            target="_blank">↗</a>
                                    </div>
                                </span>
                                <span v-if="logsType == 7">
                                    <div v-for="olog in OracleLogs" class="alert alert-success" role="alert">

                                        【{{olog.returnValues.CreaterAndCanceler}}】Canceled【#{{olog.returnValues.OracleID}}】Oracle

                                        <a :href="`https://${blockExplorer[netWork]}/tx/`+olog.transactionHash"
                                            target="_blank">↗</a>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
            <hr>
            <div style="float: none;margin-bottom: 5px;z-index: 1;">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                $NAPToken contract @:<a :href="`https://${blockExplorer[netWork]}/address/`+ NAPAddress"
                                    target="blank">{{NAPAddress}}<a class="toCopy" style="cursor: pointer;"
                                        :data-clipboard-text="NAPAddress">📑</a>
                                </a>
                                <br>
                                Your Wallet :<a :href="`https://${blockExplorer[netWork]}/address/`+addressNow"
                                    target="blank">{{addressNow}}</a> [ {{napsInWalletF}} $NAP]
                                <hr>
                                <h5 class="card-title">PCO $NAP</h5>
                                <span class="btn btn-success" style="cursor:pointer;width: 100%;" @click='claimNAP()'
                                    title="To wallet">⬆——Click to claim: {{napsUnclaimF}} $NAP to wallet——🎉</span>
                                <!-- </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body"> -->
                                <hr>
                                <h5 class="card-title">Shares: <a target="_blank" :href="swapURL[netWork]">
                                        {{swapNAME[netWork]}}</a>
                                    <button type="button" class="btn btn-light" @click='approveLPs()'
                                        style="float: right;"
                                        title="Approve $NAP-{{coinName[netWork]}} LPToken for this Contract">Approve</button>
                                </h5>
                                <div class="row" style="margin-bottom: 5px;">
                                    <div class="col-7">
                                        <a title="My $NAP-{{coinName[netWork]}} LPToken Locked Mining">{{lpTokenLockedF}}
                                            {{pairName[netWork]}} LPToken</a>
                                    </div>
                                    <div class="col-5" :title="'My Hoe in Pool proportion:' + myLPproportion+'%'">
                                        <span style="position: absolute;left: -0.4rem;top: -0.3rem;">⛏</span>
                                        <span class="progress">
                                            <span class="progress-bar progress-bar-striped progress-bar-animated"
                                                role="progressbar" aria-valuenow="75" aria-valuemin="0"
                                                aria-valuemax="100" :style="'width: '+myLPproportion+'%'">
                                                {{myLPproportion}}%</span>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="btn-group" role="group" aria-label="First group"
                                        style="cursor:pointer;width: 100%;">
                                        <input type="number" class="form-control" v-model='LPs_v_WD'
                                            placeholder="Amount" aria-label="Amount">
                                        <button type="button" class="btn btn-primary" @click='deposits(LPs_v_WD)'
                                            title="To mine field.">↑deposit</button>
                                        <button type="button" class="btn btn-primary" @click='withdraws(LPs_v_WD)'
                                            title="To wallet">↓withdraw</button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-secondary" @click='claimAllETH()' title="To wallet."
                                style="width: 100%;">unClaim ${{coinName[netWork]}}: {{ethUnclaimF}} Click to
                                ClaimALL</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="modal fade" id="staticBackdropPending" data-backdrop="static" data-keyboard="false" tabindex="-1"
            role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="position: fixed;top:30%">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 v-if="isPending" class="modal-title" id="staticBackdropLabel">
                            Do not refuse! If you sent the transaction.
                        </h5>
                        <button v-if="!isPending" type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" style="text-align: center;">

                        <div class="spinner-border text-success" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                        <div class="spinner-border text-warning" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                        <div class="spinner-border text-danger" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                        <div class="spinner-border text-dark" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                        <b>
                            ⏳Pending……
                        </b>
                    </div>
                    <div class="modal-footer">

                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade " id="staticBackdropAnnealed" data-backdrop="static" data-keyboard="false" tabindex="-1"
            role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="position: fixed;top:30%">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">
                            🎊Oracle Annealed!
                        </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        {{oracleOverContent}}
                    </div>
                    <div class="modal-footer">

                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade " id="staticBackdropJoined" data-backdrop="static" data-keyboard="false" tabindex="-1"
            role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="position: fixed;top:30%">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">
                            {{oracleJoinedTitle}}
                        </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        {{oracleJoinedContent}}
                    </div>
                    <div class="modal-footer">

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    // -------------------init ethereum
    var NAPAddress;
    var NAPContract;
    var LPAddress;
    var LPContract;
    var web3js;
    var getNetworkInterval;
    ethereum.request({ method: 'eth_requestAccounts' }).then((res) => {
        // console.log('eth:', res)
        console.log('Now account:', res[0]);
        web3js = new Web3(window.ethereum);
        // -- set cyclicity refresh for set up contract instance
        getNetworkInterval = self.setInterval("getNetwork()", 2000);
    })

    function getNetwork() {
        if (NAPContract == undefined) {
            networkId = parseInt(ethereum.chainId);
            switchNetwork(networkId)
        }
        else {
            app.intervalRefresh();
            // -- set cyclicity refresh for update info
            self.setInterval("app.intervalRefresh()", 20000);
            clearInterval(getNetworkInterval);
        }
    }

    function switchNetwork(networkId) {
        console.log('networkId:', networkId);
        switch (networkId) {
            case 1://mainnet

                NAPAddress = "0x9FA1E566BBf36A45EA07a12580FBA09940665bd1";
                app.netWork = 'Ethereum'
                app.updateToastAndShow('当前区块链未上线', `已上线BSC，请切换至BSC进行参与，或Kovan进行测试。`);
                clearInterval(getNetworkInterval);
                break;
                initContractInstance()
            case 3: // ropsten
                NAPAddress = "0x39455E9271357179d92098f35895C4F0aF2D7602";
                app.netWork = 'Ropsten'
                app.updateToastAndShow('当前区块链未上线', `已上线BSC，请切换至BSC进行参与，或Kovan进行测试。`);
                clearInterval(getNetworkInterval);
                break;
                initContractInstance()
            case 4: // Rinkeby
                NAPAddress = "0x39455E9271357179d92098f35895C4F0aF2D7602";
                app.netWork = 'Rinkeby'
                app.updateToastAndShow('当前区块链未上线', `已上线BSC，请切换至BSC进行参与，或Kovan进行测试。`);
                clearInterval(getNetworkInterval);
                break;
                initContractInstance()
            case 42://kovan
                NAPAddress = "0x0D54464EC49818BDaf6f42f465025A06CbD68ffD";
                LPAddress = "0xf00d166880f318cbf5fea6e3b6cd507ae37febe6";
                app.netWork = 'Kovan'
                initContractInstance()
                break;
            case 56://BSC
                NAPAddress = "0x4D05DE8D57b238457D62dAdd6D3B395Bbc8c9824";
                LPAddress = "0xc9a960dc0c04cde1c5729300892cb27eade5e4d0";
                app.netWork = 'BSC'
                initContractInstance()
                break;
            case 97://Bsc test
                NAPAddress = "0x39455E9271357179d92098f35895C4F0aF2D7602";
                // NAPAddress = "0x949b5948668D199B392FE8624130D47935D3b180";
                LPAddress = "0x8ec71e1568d707348c14ecadd64d145860184b8d";
                app.netWork = 'BSCTest'
                app.updateToastAndShow('当前区块链未上线', `已上线BSC，请切换至BSC进行参与，或Kovan进行测试。`);
                clearInterval(getNetworkInterval);
                break;
                initContractInstance()
            case 100://xdai
                NAPAddress = "0x9FA1E566BBf36A45EA07a12580FBA09940665bd1";
                app.netWork = 'xDAI'
                app.updateToastAndShow('当前区块链未上线', `已上线BSC，请切换至BSC进行参与，或Kovan进行测试。`);
                clearInterval(getNetworkInterval);
                break;
                initContractInstance()
            case 1337://tf
                NAPAddress = "0x39455E9271357179d92098f35895C4F0aF2D7602";
                app.netWork = 'Truffle'
                initContractInstance()
                break;
            default:
                app.updateToastAndShow('当前区块链未上线', `已上线BSC，请切换至BSC进行参与，或Kovan进行测试。`);
                clearInterval(getNetworkInterval);
                break;
        }

    }

    var LS_NetWork;
    function initContractInstance() {
        app.NAPAddress = NAPAddress;
        NAPContract = new web3js.eth.Contract(NAP_MVP_API, NAPAddress);
        LPContract = new web3js.eth.Contract(NAP_MVP_API, LPAddress);
        document.body.removeChild(document.querySelector('#stars'))
        console.log(`NAPAddress@${app.netWork}`, NAPAddress);
        // 挂载好且网络检测好之后才读取ls
        LS_NetWork = app.netWork;
        app.LSCache = LocalData_Cache.fetch();
        app.LSSent = LocalData_Sent.fetch();
        app.LSWaitJoin = LocalData_WaitJoin.fetch();

        initUserData();
    }
    async function initUserData() {
        await app.RefreshAccount();
        await app.intervalRefresh();
        await app.getJoinAbleOracles();
        await app.subscribeJoin(app.LSWaitJoin);
    }
    // ------------------ ethereum on
    ethereum.autoRefreshOnNetworkChange = true;
    ethereum.on('chainChanged', function (networkId) {
        location.reload();
    })
    ethereum.on('accountsChanged', async function (accounts) {
        initUserData()
    })

    function sleep(time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }


    // ----------------------- Local Storage
    var LocalData = {
        fetch: function () {
            //整个取
            let _oracles = JSON.parse(localStorage.getItem("Datas") || '[]');
            return _oracles
        },
        save: function (_oracles) {
            //整个存
            localStorage.setItem("Datas", JSON.stringify(_oracles))
        }
    };
    var LocalData_Cache = {
        fetch: function () {
            //整个取
            let _oracles = JSON.parse(localStorage.getItem(LS_NetWork + "Cache") || '[]');
            return _oracles
        },
        save: function (_oracles) {
            //整个存
            localStorage.setItem(LS_NetWork + "Cache", JSON.stringify(_oracles))
        }
    };
    var LocalData_Sent = {
        fetch: function () {
            //整个取
            let _oracles = JSON.parse(localStorage.getItem(LS_NetWork + "Sent") || '[]');
            return _oracles
        },
        save: function (_oracles) {
            //整个存
            localStorage.setItem(LS_NetWork + "Sent", JSON.stringify(_oracles))
        }
    };
    var LocalData_WaitJoin = {
        fetch: function () {
            //整个取
            let _oracles = JSON.parse(localStorage.getItem(LS_NetWork + "Listening") || '[0]');
            return _oracles
        },
        save: function (_oracles) {
            //整个存
            localStorage.setItem(LS_NetWork + "Listening", JSON.stringify(_oracles))
        }
    };
    var myDate = new Date();
    // function getLocalTime(nS) {
    //     return new Date(parseInt(nS) * 1000).toLocaleString().replace(/:\d{1,2}$/, ' ');
    // }
    window.onresize = function () {
        //TODO 高宽比 弹性布局 自动换行这类
        document.body.removeChild(document.getElementsByTagName('canvas')[0])
        pattern = trianglify({
            width: window.innerWidth,
            height: window.innerHeight,
        })
        document.body.appendChild(pattern.toCanvas());
    };
    // uid生成器
    function guid() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0,
                v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }
    var app = new Vue({
        el: '#app',
        data: function () {
            return {
                NAPAddress: NAPAddress,
                w3: web3js = new Web3(window.ethereum),
                addressNow: '0x0000000000000000000000000000000000000000',
                LSCache: '',//LocalData_Cache.fetch(),
                LSSent: '',//LocalData_Sent.fetch(),
                LSWaitJoin: '',
                LSD: LocalData.fetch(),
                //宏观数据
                TotalSupply: 0,
                SpiritComingEvents: '',
                BlockNumber: 0,
                timeNow: myDate.toLocaleDateString() + '-' + myDate.toLocaleTimeString(),
                totalLPLocked1e18: '',
                classificationTexts: { 99: 'Click Left Side Button to show', 0: 'Able to join', 1: 'Wait join', 2: 'Wait anneal', 3: 'Wait anneal' },
                cfBtnNumber: 99,
                oracleMenu: true,
                netWork: '',
                coinName: { 'Ethereum': 'ETH', 'Truffle': 'ETH', 'xDAI': 'ETH', 'Kovan': 'ETH', 'BSC': 'BNB', 'BSCTest': 'BNB' },
                blockExplorer: { 'Kovan': 'kovan.etherscan.io', 'BSC': 'bscscan.com', 'BSCTest': 'testnet.bscscan.com' },
                swapURL: { 'Kovan': 'https://app.uniswap.org/#/swap?outputCurrency=0x0D54464EC49818BDaf6f42f465025A06CbD68ffD', 'BSC': 'https://app.unisave.exchange/#/swap?inputCurrency=0x4d05de8d57b238457d62dadd6d3b395bbc8c9824&outputCurrency=0xe9e7cea3dedca5984780bafc599bd69add087d56' },
                swapNAME: { 'Kovan': '$NAP-$ETH LPToken of Uniswap', 'BSC': '$NAP-$BUSD LPToken of Unisave' },
                pairName: { 'Kovan': '$NAP-$ETH', 'BSC': '$NAP-$BUSD' },
                NAPDBN: { 'Kovan': 23370920, 'BSC': 5094625 },
                //个人数据
                oracle_myStrategy: 0,
                napsInWallet1e18: 0,
                napsInWalletF: 0,
                NAPs_v_WD: '',
                LPs_v_WD: '',
                napsUnclaim1e18: 0,
                napsUnclaimF: 0,
                lpTokenLocked1e18: 0,
                lpTokenLockedF: 0,
                ethUnclaim1e18: 0,
                ethUnclaimF: 0,
                myLPproportion: 0,

                //通知数据
                toastTitle: 'NASH #0 MVP',
                toastContent: 'Welcome to NASH protocol. This page is the interface of #0 MVP Contract which is the first contract of NASH——100 plan. \
                This toast will been used to show notification when get feedback from blockChain and will auto close in 5 mins.',
                //Oracle数据
                isPending: false,
                oracle_filter_joinfee: '',
                oracle_filter_waitblocks: '',
                oracle_filter_IdStart: LocalData.fetch()[0] == undefined ? 1 : LocalData.fetch()[0],// LocalData.fetch(),
                oracle_create_joinfee: '',
                oracle_create_waitblocks: '',
                oracle_create_rawEntropy: '',
                oracle_create_bidFee: '',
                fingers: { 0: '🤝', 201: '💡', 1: '✌', 2: '✊', 3: '✋' },
                stateMapping: { 255: 'Wait join', 201: 'Joined&setStg', 1: '✌', 2: '✊', 3: '✋' },//现在已经没有255
                OracleDatas: [],
                OracleLogs: [],
                FilterState: 0,// 1:in lobby not joined ,2:wait you to anneal ,3: wait init to anneal,4:expired
                MyState: 0,
                filterText: { 1: 'Create@', 2: 'Expire@', 3: 'Will expire@', 4: 'Already expired@' },
                filterButtonText: { 1: { 0: 'Able to join', 201: 'Wait Gote Join' }, 2: { 4: 'My Joined', 201: 'My Created wait gote' }, 3: 'Wait Anneal', 4: 'Expired' },
                LimitsReturn: 10,
                alertAtOracleCreate: '',
                showAlertAtOracleCreate: false,
                joiningOracleID: '',
                joiningOracleCreateAt: '',
                joiningOracleJoinFee: '',
                joiningOracleWaitBlock: '',
                joiningOraclePrize: '',
                oracle_joing_bidFee: '',
                oracle_join_joinfee: '',
                oracle_overReason: { 0: 'AnnealInitWin', 1: 'AnnealGoteWin', 2: 'CriticalAnnealed', 3: 'AnnealExpiredOracle' },
                /// oracle logs
                logsType: 0,
                /// dialogs
                oracleOverContent: '',
                oracleJoinedTitle: '',
                oracleJoinedContent: '',
                //test
                dt: '',

            }
        },
        //生命周期
        beforeCreat() {

        },
        Created() {

        },
        beforeMount() {

        },
        mounted() {

        },
        beforeUpdate() {

        },
        updated() {

        },
        beforeDestory() {

        },
        destoryed() {

        },
        watch: {
            oracle_filter_IdStart: {
                handler: function (oracle_filter_IdStart) {
                    this.LSD[0] = oracle_filter_IdStart
                    LocalData.save(this.LSD)
                },
                deep: true
            }
        },
        //方法
        methods: {
            // // 国际化
            // // internationalization(_lg) {
            // //     if (_lg == 'zh') {
            // //         this.title = '{{GovHoeTokenName}} 治理'
            // //     } else if (_lg == 'en') {
            // //         this.title = '{{GovHoeTokenName}} Gov'
            // //     }
            // // },

            // 1 数据处理方法
            _formatBigNumber(_bn) {
                // return web3js.utils.fromWei(_bn, 'ether');
                return parseFloat(web3js.utils.fromWei(_bn, 'ether')).toLocaleString();
                // parseFloat().toLocaleString();
            },
            // 2 数据展示方法
            updateToastAndShow(title, content) {
                myDate = new Date();
                this.timeNow = myDate.toLocaleDateString() + '-' + myDate.toLocaleTimeString();
                this.toastTitle = title;
                this.toastContent = content;
                $('.toast').toast('show');
            },
            updateAlertInOracleCreate(swc, content) {
                this.alertAtOracleCreate = content;
                this.showAlertAtOracleCreate = swc;
            },
            // 3 数据获取方法
            async RefreshAccount() {
                this.addressNow = (await ethereum.request({ method: 'eth_accounts' }))[0];
            },
            // - 周期性刷新
            async intervalRefresh() {
                await this.individual();
                await this.macroeconomic();
            },
            // 个人数据 ---- start
            async individual() {
                // 等更新之后才有default地址
                await this.getMyUnclaimNAP();
                await this.getMyUnClaimETHs();
                await this.getLPTokenProportion();
                await this.getMyNAPsInWallet();
                this.addressNow = (await ethereum.request({ method: 'eth_accounts' }))[0];
            },
            async getMyUnclaimNAP() {
                this.napsUnclaim1e18 = await NAPContract.methods.PCO_NapsNowCanClaim(this.addressNow).call();
                this.napsUnclaimF = this._formatBigNumber(this.napsUnclaim1e18);
            },
            async getMyUnClaimETHs() {
                this.ethUnclaim1e18 = await NAPContract.methods.unClaimedETHsOf(this.addressNow).call();
                this.ethUnclaimF = this._formatBigNumber(this.ethUnclaim1e18);
            },
            async getLPTokenProportion() {
                await this.getMyLockedLP();
                await this.getTotalLPLocked();
                // console.log(Number(this.lpTokenLocked1e18), Number(this.totalLPLocked1e18))
                this.myLPproportion = (Number(this.lpTokenLocked1e18) / Number(this.totalLPLocked1e18)) * 100;
            },
            async getMyLockedLP() {
                this.lpTokenLocked1e18 = await NAPContract.methods.playerToHoes(this.addressNow).call();
                this.lpTokenLockedF = this._formatBigNumber(this.lpTokenLocked1e18);
            },
            async getTotalLPLocked() {
                this.totalLPLocked1e18 = await NAPContract.methods.totalHoesLocked().call();
                this.totalLPLockedF = this._formatBigNumber(this.totalLPLocked1e18);
            },
            async getMyNAPsInWallet() {
                this.napsInWallet1e18 = await NAPContract.methods.balanceOf(this.addressNow).call();
                this.napsInWalletF = this._formatBigNumber(this.napsInWallet1e18);
            },
            // 个人数据 ---- end
            // 日志数据 ---- start
            async getMyCreateLogs() {
                // $('#staticBackdropPending').modal('show')
                this.OracleLogs = []
                this.logsType = 1
                this.dt = (await NAPContract.getPastEvents('newOracleCreateAndHashStgSet', { filter: { Creater: this.addressNow }, fromBlock: this.BlockNumber - 4900 })).reverse();
                this.OracleLogs = this.dt;
                // $('#staticBackdropPending').modal('hide')
                this.updateToastAndShow('My Oracle logs', `Fetched ${this.dt.length} My created logs.`);
            },
            async getMyJoinedLogs() {
                // $('#staticBackdropPending').modal('show')
                this.OracleLogs = []
                this.logsType = 2
                this.dt = (await NAPContract.getPastEvents('GoteJoinedAndRawStgSet', { filter: { Player: this.addressNow }, fromBlock: this.BlockNumber - 4900 })).reverse();
                this.OracleLogs = this.dt;
                // $('#staticBackdropPending').modal('hide')
                this.updateToastAndShow('My Oracle logs', `Fetched ${this.dt.length} My joined logs.`);
            },
            async getMyWonLogs() {
                // $('#staticBackdropPending').modal('show')
                this.OracleLogs = []
                this.logsType = 3
                this.dt = (await NAPContract.getPastEvents('OracleOver', { filter: { Winner: this.addressNow }, fromBlock: this.BlockNumber - 4900 })).reverse();
                this.OracleLogs = this.dt;
                // $('#staticBackdropPending').modal('hide')
                this.updateToastAndShow('My Oracle logs', `Fetched ${this.dt.length} My won logs.`);
            },
            async getReCrLogs() {
                // $('#staticBackdropPending').modal('show')
                this.OracleLogs = []
                this.logsType = 4
                this.dt = (await NAPContract.getPastEvents('newOracleCreateAndHashStgSet', { filter: {}, fromBlock: this.BlockNumber - 4900 })).reverse();
                this.OracleLogs = this.dt;
                // $('#staticBackdropPending').modal('hide')
                this.updateToastAndShow('All Oracle logs', `Fetched ${this.dt.length} Recently created logs.`);
            },
            async getReJnLogs() {
                // $('#staticBackdropPending').modal('show')
                this.OracleLogs = []
                this.logsType = 5
                this.dt = (await NAPContract.getPastEvents('GoteJoinedAndRawStgSet', { filter: {}, fromBlock: this.BlockNumber - 4900 })).reverse();
                this.OracleLogs = this.dt;
                // $('#staticBackdropPending').modal('hide')
                this.updateToastAndShow('All Oracle logs', `Fetched ${this.dt.length} Recently Joined logs.`);
            },
            async getReOvLogs() {
                // $('#staticBackdropPending').modal('show')
                this.OracleLogs = []
                this.logsType = 6
                this.dt = (await NAPContract.getPastEvents('OracleOver', { filter: {}, fromBlock: this.BlockNumber - 4900 })).reverse();
                this.OracleLogs = this.dt;
                // $('#staticBackdropPending').modal('hide')
                this.updateToastAndShow('All Oracle logs', `Fetched ${this.dt.length} Recently over logs.`);
            },
            async getReCcd() {
                // $('#staticBackdropPending').modal('show')
                this.OracleLogs = []
                this.logsType = 7
                this.dt = (await NAPContract.getPastEvents('OracleCanceled', { filter: {}, fromBlock: this.BlockNumber - 4900 })).reverse();
                this.OracleLogs = this.dt;
                // $('#staticBackdropPending').modal('hide')
                this.updateToastAndShow('All Oracle logs', `Fetched ${this.dt.length} Recently canceled logs.`);
            },
            // 日志数据 ---- end
            // 宏观数据 ----- start
            async macroeconomic() {
                if (NAPContract == undefined) return;
                await this.getBlockNumber();
                await this.getNAPTotalSupply();
            },
            async getNAPTotalSupply() {
                let rst = await NAPContract.methods.totalSupply().call();
                // console.log('ttspl',rst);
                this.TotalSupply = this._formatBigNumber(rst);
            },
            async getBlockNumber() {
                web3js.eth.getBlockNumber().then((rst) => {
                    this.BlockNumber = rst;
                    // console.log(rst) 
                })
            },
            // 宏观数据 ---- end

            // 4 数据写入链上方法
            async claimNAP() {
                this.updateToastAndShow('Claim $NAPs', `Pending: Claim ${this.napsUnclaimF} $NAPs to wallet …… ……`);
                let rst = await NAPContract.methods.PCO_claimNAP().send({ from: this.addressNow });
                this.updateToastAndShow('Claim $NAPs', `Success: Claimed ${this.napsUnclaimF} $NAPs to wallet.`);
                await this.getMyUnclaimNAP();
                await this.getMyNAPsInWallet();
                // console.log(rst);
            },
            // create
            createOracleAndSetHashStg() {
                if (this.oracle_create_waitblocks == '') {
                    this.oracle_create_waitblocks = 4000;
                }
                if (this.oracle_create_bidFee == '') {
                    this.oracle_create_bidFee = 0;
                }
                if (this.oracle_myStrategy == 0) {
                    this.updateAlertInOracleCreate(true, 'Please select strategy✌✊✋.');
                    return
                }
                else if (this.oracle_create_joinfee == '' || this.oracle_create_rawEntropy == '') {

                    this.updateAlertInOracleCreate(true, 'Please full form.');
                    return
                } else if (Number(this.oracle_create_bidFee) > Number(this.napsInWallet1e18) / 1e18) {
                    this.updateAlertInOracleCreate(true, 'Insufficient $NAPs in wallet for bid fee.');
                    return
                } else if (Number(this.oracle_create_waitblocks) > 4900 || Number(this.oracle_create_waitblocks) < 10) {
                    this.updateAlertInOracleCreate(true, 'WaitBlocks should be in range [10,4900].');
                    return
                }
                this.updateAlertInOracleCreate(false, '✅Form fulled. Please check and confirm.');
                cfm = confirm(`
                waitBlock：    【${this.oracle_create_waitblocks}】
                JoinFee：       【${this.oracle_create_joinfee}】 $${this.coinName[this.netWork]}
                BidFee:       【${this.oracle_create_bidFee}】 $NAP for 95% JoinFee
                Strategy:     【${this.fingers[this.oracle_myStrategy]}】
                EntropyRaw:   【${this.oracle_create_rawEntropy}】
                Sure to Create Oracle?`)
                if (cfm) {
                    let timeNow = myDate.toLocaleDateString() + '-' + myDate.toLocaleTimeString();
                    // 天时timeNow 地利guid() 人和oracle_create_rawEntropy
                    let hsetp = web3js.utils.keccak256(timeNow + guid() + this.oracle_create_rawEntropy);
                    let stg = this.oracle_myStrategy;
                    let bid = web3js.utils.toWei(String(this.oracle_create_bidFee));
                    let EncryptedStg = this.encryption(hsetp, stg, bid);

                    this.LSCache.push({ EncryptedStg, hsetp, stg, bid });
                    LocalData_Cache.save(this.LSCache);

                    this.updateToastAndShow('Create Oracle', `Pending:Create Oracle  …… ……`);
                    this.updateAlertInOracleCreate(false, 'Pending: Create Oracle …… ……');
                    $('#staticBackdropPending').modal('show')
                    $('#staticBackdropCreateOracle').modal('hide')
                    this.isPending = true;
                    NAPContract.methods.createOracleAndSetHashStg(this.oracle_create_waitblocks, EncryptedStg).send({ from: this.addressNow, value: web3js.utils.toWei(String(this.oracle_create_joinfee)) }).then((rst) => {
                        // console.log(rst);
                        this.dt = rst;
                        let oid = parseInt(rst.events.newOracleCreateAndHashStgSet.returnValues.OracleID);
                        this.updateAlertInOracleCreate(false, `Success: 【#${oid}】Oracle Created, you can close this window now.`);
                        // 记录发出的加密策略的原象
                        this.LSSent[oid] = { hsetp, stg, bid };
                        LocalData_Sent.save(this.LSSent);
                        // 删除防止刷新丢失捕捉的加密策略原象
                        this.LSCache.pop();
                        LocalData_Cache.save(this.LSCache);


                        //获取创建后等待gote的列表展示：创建后→展示自己创建可以取消的
                        (this.cfBtnNumber = 1) & (oid - 9 < 0 ? this.oracle_filter_IdStart = 0 : this.oracle_filter_IdStart = oid - 9) & (this.MyState = 201) & (this.FilterState = 1) & (this.getMyOracleIDsRLByState(this.FilterState, this.MyState, this.oracle_filter_IdStart, this.LimitsReturn))

                        this.isPending = false;
                        $('#staticBackdropPending').modal('hide')

                        sleep(1000)
                        // 记录等待加入的监听Oid
                        this.LSWaitJoin.push(parseInt(oid));
                        LocalData_WaitJoin.save(this.LSWaitJoin);
                        this.subscribeJoin(this.LSWaitJoin);

                    })
                }

            },
            encryption(hsetp, stg, bid) {
                // hsetp = web3js.utils.keccak256(hsetp);
                return web3js.utils.keccak256(web3js.eth.abi.encodeParameters(['string', 'uint256', 'uint256'], [hsetp, stg, bid]));
            },
            // cancel
            cancelButtonClick(oracleData) {
                oid = parseInt(oracleData.OracleID);
                this.updateToastAndShow(`Cancel Oracle`, `Pending: Oracle【#${oid}】 Cancel  …… ……`);
                NAPContract.methods.cancelOracle(oid).send({ from: this.addressNow }).then((rst) => {
                    this.updateToastAndShow('Cancel Oracle', `Success:【#${oid}】Oracle Canceled.`);
                    this.getMyCreateWaitJoin();
                    // 删除sent 策略释放空间
                    delete this.LSSent[oid];
                    LocalData_Sent.save(this.LSSent);
                    // 删除监听
                    this.deleteSubscribeJoin(oid);
                })

            },
            // join
            joinButtonClick(oracleData) {
                this.oracle_joing_bidFee = ""
                this.oracle_myStrategy = 0
                this.updateAlertInOracleCreate(false, "Please select a strategy and full form.");
                this.joiningOraclePrize = parseFloat(this.w3.utils.fromWei(String(oracleData.joinFee), "ether")) * 1.9
                this.oracle_join_joinfee = this.w3.utils.fromWei(oracleData.joinFee, "ether")
                this.joiningOracleID = oracleData.OracleID
                this.joiningOracleCreateAt = oracleData.markBlock
                this.joiningOracleJoinFee = oracleData.joinFee
                this.joiningOracleWaitBlock = oracleData.waitBlocks
            },
            joinOracleAndSetGoteRawStg(ooid) {
                let oid = parseInt(ooid)
                if (this.oracle_myStrategy == 0) {
                    // alert('Please select strategy.');
                    // this.alertAtOracleCreate = 'Please select strategy.';
                    this.updateAlertInOracleCreate(true, 'Please select strategy✌✊✋.');
                    return
                }
                else if (Number(this.oracle_joing_bidFee) > Number(this.napsInWallet1e18) / 1e18) {
                    this.updateAlertInOracleCreate(true, 'Insufficient $NAPs in bank for bid fee.');
                    return
                }
                if (this.oracle_joing_bidFee == '') {
                    // alert('Please full data.');
                    // this.alertAtOracleCreate = 'Please full data.';
                    this.oracle_joing_bidFee = 0;
                    // this.updateAlertInOracleCreate(true, 'Please input bid fee.');
                    // return
                }
                this.updateToastAndShow('Join Oracle', `Pending:【#${oid}】Oracle Joining  …… ……`);
                this.updateAlertInOracleCreate(false, `Pending:【${this.fingers[this.oracle_myStrategy]}】 Joining Oracle …… ……`);
                // console.log(oid,this.oracle_myStrategy,this.oracle_joing_bidFee,web3js.utils.toWei(String(this.oracle_join_joinfee)))
                $('#staticBackdropPending').modal('show')
                $('#staticBackdropJoinOracle').modal('hide')
                NAPContract.methods.joinOracleAndSetGoteRawStg(oid, this.oracle_myStrategy, web3js.utils.toWei(String(this.oracle_joing_bidFee))).send({ from: this.addressNow, value: web3js.utils.toWei(String(this.oracle_join_joinfee)) }).then((rst) => {
                    console.log(rst);
                    this.updateAlertInOracleCreate(false, `Success: 【#${oid}】Oracle joined. You can close this window and click button:【My joined, wait init to anneal】to see it. If the oracle expired you can finish it and direct win.`);
                    // this.updateToastAndShow('Join Oracle', `Success:Oracle joined.`);
                    // 加入之后→刷新显示可以继续加入的，Filter OID保持不变
                    (this.MyState = 0) & (this.FilterState = 1) & (this.getWaitJoinOracleIDsRL(this.oracle_filter_IdStart, this.LimitsReturn))
                    $('#staticBackdropPending').modal('hide')
                })
            },
            // anneal
            async annealButtonClick(oracleData) {
                oid = parseInt(oracleData.OracleID);
                console.log('oid', oid)
                this.updateToastAndShow('Anneal Oracle', `Getting: Oracle【#${oid}】 Opponent  …… ……`);
                // let _opponent = (await NAPContract.getPastEvents('GoteJoinedAndRawStgSet', { filter: { OracleID: oid }, fromBlock: this.NAPDBN[this.netWork] })).pop().returnValues.Player;
                let _opponent = (await NAPContract.getPastEvents('GoteJoinedAndRawStgSet', { filter: { OracleID: oid }, fromBlock: this.BlockNumber - 4900 })).pop().returnValues.Player;
                let ols = this.LSSent[oid]
                console.log(_opponent)
                console.log('ols', ols)
                // 处理加密参数丢失：未提交成功就刷新的情况
                let MissAgrs; // means not missing
                // let cacheIndex;
                if (ols == undefined) {
                    MissAgrs = true;// means missing
                    // 需要去cache中寻找hash对应的oid
                    console.log('Start to fix missing Oracle hash preImage args', oid)
                    for (let i = 0; i < this.LSCache.length; i++) {
                        try {
                            console.log('for index:', i)
                            // let _gotOid = (await NAPContract.getPastEvents('newOracleCreateAndHashStgSet', { filter: { stgHash: this.LSCache[i].EncryptedStg }, fromBlock: this.NAPDBN[this.netWork] }))[0].returnValues.OracleID;
                            let _gotOid = (await NAPContract.getPastEvents('newOracleCreateAndHashStgSet', { filter: { stgHash: this.LSCache[i].EncryptedStg }, fromBlock: this.BlockNumber - 4900 }))[0].returnValues.OracleID;
                            console.log('oid', oid)
                            if (_gotOid == undefined) {
                                console.log('index:', i, '未找到原象', oid)
                                continue
                            } else if (parseInt(_gotOid) == oid) {
                                // 找到了缓存hash中对应的oid
                                let hsetp = this.LSCache[i].hsetp
                                let stg = this.LSCache[i].stg
                                let bid = this.LSCache[i].bid
                                this.LSSent[oid] = { hsetp, stg, bid };
                                LocalData_Sent.save(this.LSSent);
                                ols = { hsetp, stg, bid };
                                // MissAgrs = 2// means missing and found back
                                MissAgrs = false;
                                // cacheIndex = i;
                                delete this.LSCache[i];
                                LocalData_Cache.save(this.LSCache);
                            }
                        } catch (error) {
                            console.log('Recover stg err:', error)
                        }

                    }
                }
                // console.log(MissAgrs)
                if (MissAgrs) {
                    this.updateToastAndShow(`Anneal Oracle【#${oid}】`, `Encryption parameter missing`);
                    return;
                }

                this.updateToastAndShow(`Anneal Oracle【#${oid}】`, `Pending: Anneal Oracle …… ……`);
                this.isPending = true;
                $('#staticBackdropPending').modal('show')
                // console.log(oid, ols.hsetp, ols.stg, ols.bid)
                let rst = await NAPContract.methods.makeAnneal(oid, ols.hsetp, ols.stg, ols.bid, _opponent).send({ from: this.addressNow });
                this.dt = rst;
                // 删除sent 策略释放空间
                if (rst.events.OracleOver.type == "mined") {
                    delete this.LSSent[oid];
                    LocalData_Sent.save(this.LSSent);
                }
                // 删除监听
                this.deleteSubscribeJoin(oid)

                $('#staticBackdropPending').modal('hide')
                this.isPending = false;
                this.oracleOverContent = '';
                let evt = rst.events.OracleOver.returnValues;
                this.dt = evt;
                let _overTitle;
                let _overText;
                if (evt.Winner.toLowerCase() == this.addressNow) {
                    _overTitle = `Annealed Oracle【#${oid}】`;
                    _overText = `【😁:You Win🎉!】. 【🏆:${web3js.utils.fromWei(String(evt.Prize), 'ether')}$${this.coinName[this.netWork]}】.【(Init) Your Stg:${this.fingers[evt.Strategy_Init]}】.【GoteStg:${this.fingers[evt.Strategy_Gote]}】.【OraclePrice:${parseFloat(String(2 * evt.ValidBid / evt.Prize)).toLocaleString()}$NAP/$${this.coinName[this.netWork]}】.【OverReason:${this.oracle_overReason[evt.Reason]}】`;

                } else {
                    _overTitle = `Annealed Oracle【#${oid}】`;
                    _overText = `【Winner:${evt.Winner}】. 【🏆:${web3js.utils.fromWei(String(evt.Prize), 'ether')}$${this.coinName[this.netWork]}】.【(Init) Your Stg:${this.fingers[evt.Strategy_Init]}】.【GoteStg:${this.fingers[evt.Strategy_Gote]}】.【OraclePrice:${parseFloat(String(2 * evt.ValidBid / evt.Prize)).toLocaleString()}$NAP/$${this.coinName[this.netWork]}】.【OverReason:${this.oracle_overReason[evt.Reason]}】`;
                }
                this.getMyCreateWaitAnneal()

                this.oracleOverContent = _overTitle + _overText;
                $('#staticBackdropAnnealed').modal('show')

            },
            // expired
            async expiredButtonClick(oracleData) {
                oid = parseInt(oracleData.OracleID);
                this.updateToastAndShow(`Finish expired Oracle`, `Getting: Oracle【#${oid}】 Opponent  …… ……`);
                // let _opponent = (await NAPContract.getPastEvents('newOracleCreateAndHashStgSet', { filter: { OracleID: oid }, fromBlock: this.NAPDBN[this.netWork] })).pop().returnValues.Creater;
                this.updateToastAndShow(`Finish expired Oracle`, `Pending: Finish expired Oracle【#${oid}】  …… ……`);
                let rst = await NAPContract.methods.finishExpiredOracle(oid).send({ from: this.addressNow });
                let evt = rst.events.OracleOver.returnValues;
                this.dt = rst;
                this.updateToastAndShow(`Finish expired Oracle【#${evt.OracleID}】`, `【😁:You win】. 【🏆:${web3js.utils.fromWei(String(evt.Prize), 'ether')}$${this.coinName[this.netWork]}】.【OverReason:${this.oracle_overReason[evt.Reason]}】`);
                await this.getMyJoinedWaitAnneal()
            },
            // mining
            async approveLPs() {
                this.updateToastAndShow('Approve', 'Approve #0 MVP Contract to spend your LPTokens.')
                await LPContract.methods.approve(NAPAddress, web3js.utils.toBN('115792089237316195423570985008687907853269984665640564039457584007913129639935')).send({ from: this.addressNow });
            },
            deposits(_amount) {
                if (_amount == 0) {
                    this.updateToastAndShow('Error@Deposit LP', 'Deposit amount can not be zero.')
                    return
                }
                this.updateToastAndShow('$LPs interaction', 'Pending: Deposit $LPs hoe to #0 MVP Contract …… ……')
                NAPContract.methods.deposit(web3js.utils.toWei(String(_amount))).send({ from: this.addressNow }).then(() => {
                    this.updateToastAndShow('$LPs interaction', 'Success: Deposit $LPs hoe to #0 MVP Contract.');
                    this.intervalRefresh();
                })
            },
            withdraws(_amount) {
                if (_amount == 0) {
                    this.updateToastAndShow('Error@Withdraw LP', 'Withdraw amount can not be zero.')
                    return
                }
                this.updateToastAndShow('$LPs interaction', 'Pending: Withdraw $LPs hoe from #0 MVP Contract …… ……')
                NAPContract.methods.withdraw(web3js.utils.toWei(String(_amount))).send({ from: this.addressNow }).then(() => {
                    this.updateToastAndShow('$LPs interaction', 'Success: Withdraw $LPs hoe from #0 MVP Contract.');
                    this.intervalRefresh();
                })
            },
            async claimAllETH() {
                this.updateToastAndShow(`Claim $${this.coinName[this.netWork]}`, `Pending: Claim ${this.ethUnclaimF} $${this.coinName[this.netWork]}s to wallet …… ……`);
                let rst = await NAPContract.methods.claim().send({ from: this.addressNow });
                this.updateToastAndShow(`Claim $${this.coinName[this.netWork]}s`, `Success: Claimed ${this.ethUnclaimF} $${this.coinName[this.netWork]}s to wallet.`);
            },
            // 5 Oracle 查询方法
            getJoinAbleOracles() {
                (this.cfBtnNumber = 0) & (this.MyState = 0) & (this.FilterState = 1) & (this.getWaitJoinOracleIDsRL(this.oracle_filter_IdStart, this.LimitsReturn))
            },
            getMyCreateWaitJoin() {
                (this.cfBtnNumber = 1) & (this.MyState = 201) & (this.FilterState = 1) & (this.getMyOracleIDsRLByState(this.FilterState, this.MyState, this.oracle_filter_IdStart, this.LimitsReturn))
            },
            getMyCreateWaitAnneal() {
                (this.cfBtnNumber = 2) & (this.MyState = 201) & (this.FilterState = 2) & (this.getMyOracleIDsRLByState(this.FilterState, this.MyState, this.oracle_filter_IdStart, this.LimitsReturn))
            },
            getMyJoinedWaitAnneal() {
                (this.cfBtnNumber = 3) & (this.MyState = 4) & (this.FilterState = 2) & (this.getMyOracleIDsRLByState(this.FilterState, this.MyState, this.oracle_filter_IdStart, this.LimitsReturn))
            },

            getWaitJoinOracleIDsRL(_startID, _limit) {
                if (_startID == '') { _startID = 1 };
                this.OracleDatas = [];
                this.updateToastAndShow(`${this.filterButtonText[1][0]} Refresh`, `Please wait, fetching ${this.filterButtonText[1][0]} datas …… ……`);
                NAPContract.methods.getWaitJoinOracleIDsRL(_startID, _limit).call({ from: this.addressNow }).then((OracleIDRLs) => {
                    cacheOracleDatas = [];
                    for (let i = 0; OracleIDRLs[0][i] != 0; i++) {
                        NAPContract.methods.Oracles(OracleIDRLs[0][i]).call().then((rst2) => {
                            rst2.OracleID = OracleIDRLs[0][i];
                            rst2.myUintInTheOracle = OracleIDRLs[1][i];
                            cacheOracleDatas.push(rst2);
                        })
                    }
                    this.OracleDatas = cacheOracleDatas;
                    this.updateToastAndShow(`${this.filterButtonText[1][0]}`, `Success: Oracle ID in range 【#${_startID}~#${Number(_startID) + Number(_limit) - 1}】——> Fetched ${this.filterButtonText[1][0]} datas.`);
                });
            },
            getMyOracleIDsRLByState(_state, _myState, _startID, _limit) {
                if (_startID == '') { _startID = 1 };
                this.OracleDatas = [];
                this.updateToastAndShow(`${this.filterButtonText[_state][_myState]} Refresh`, `Please wait, fetching ${this.filterButtonText[_state][_myState]} datas …… ……`);
                NAPContract.methods.getMyOracleIDsRLByState(_state, _startID, _limit).call({ from: this.addressNow }).then((OracleIDRLs) => {

                    cacheOracleDatas = [];

                    if (_myState == 201) {//自己创建的（等待加入和等待退火的）
                        // console.log('xx')
                        for (let i = 0; OracleIDRLs[0][i] != 0; i++) {
                            if (OracleIDRLs[1][i] == 201) {
                                NAPContract.methods.Oracles(OracleIDRLs[0][i]).call().then((rst2) => {
                                    if (_state == rst2.state) {
                                        rst2.OracleID = OracleIDRLs[0][i];
                                        rst2.myUintInTheOracle = OracleIDRLs[1][i];
                                        cacheOracleDatas.push(rst2);
                                    }
                                })
                            }
                        }
                    } else if (_myState == 4) {//别人创建自己加入的（等待对方退火和处理过期的）

                        for (let i = 0; OracleIDRLs[0][i] != 0; i++) {//只要返回的ID有效就继续处理
                            if (OracleIDRLs[1][i] < 4 && OracleIDRLs[1][i] > 0) {//只要符合uint是gote就处理
                                // console.log(i)
                                NAPContract.methods.Oracles(OracleIDRLs[0][i]).call().then((rst2) => {
                                    if (_state == rst2.state) {
                                        rst2.OracleID = OracleIDRLs[0][i];
                                        rst2.myUintInTheOracle = OracleIDRLs[1][i];
                                        cacheOracleDatas.push(rst2);
                                    }
                                })
                            }
                        }
                    }

                    this.OracleDatas = cacheOracleDatas;
                    // console.log(cacheOracleDatas.length)
                    this.updateToastAndShow(`${this.filterButtonText[_state][_myState]}`, `Success: Oracle ID in range 【#${_startID}~#${Number(_startID) + Number(_limit) - 1}】——> Fetched ${this.filterButtonText[_state][_myState]} datas.`);
                });
            },
            // 订阅方法
            subscribeCreate() {

                // 这得吵死
                NAPContract.events.newOracleCreateAndHashStgSet({ filter: {}, fromBlock: this.BlockNumber - 5000 }, function (error, event) { console.log(event); })
                    .on('data', function (event) {
                        this.dt = event;
                        console.log(event); // same results as the optional callback above
                    })
                    .on('changed', function (event) {
                        // remove event from local database
                    })
                    .on('error', console.error)
            },
            subscribeJoin(_oids) {
                // if(_oids.length == 0) _oids = [0];
                console.log('_oids', _oids);
                NAPContract.events.GoteJoinedAndRawStgSet({ filter: { OracleID: _oids }, fromBlock: this.BlockNumber - 4900 }, function (error, event) {

                    app.dt = event;

                    try {
                        app.oracleJoinedTitle = `#${event.returnValues.OracleID} been joined: 【${app.fingers[parseInt(event.returnValues.Strategy_Raw)]}】 & 【${app.w3.utils.fromWei(String(event.returnValues.GoteOracleBid), 'ether')} $NAP】`;
                        app.oracleJoinedContent = `By 【${event.returnValues.Player}】.`
                        $('#staticBackdropJoined').modal('show')
                    } catch (error) {
                        console.log(event, 'error', error);
                    }

                    // x.splice(x.indexOf(3),1)
                })
                    .on('data', function (event) {
                        // console.log('.on(data',event); // same results as the optional callback above
                    })
                    .on('changed', function (event) {
                        // remove event from local database
                    })
                    .on('error', console.error)
            },
            deleteSubscribeJoin(_oid) {
                try {
                    this.LSWaitJoin.splice(this.LSWaitJoin.indexOf(parseInt(_oid)), 1);
                    LocalData_WaitJoin.save(this.LSWaitJoin);
                } catch (error) {
                    console.log('#', _oid, ': delete listen wait join error, may not listening', error)
                }
            },
            // test
            // csent() {
            //     this.LSSent = [];
            //     LocalData_Sent.save(this.LSSent);
            // },
            // ccache() {
            //     this.LSCache = [];
            //     LocalData_Cache.save(this.LSCache);
            // },
            cWaitJoin() {
                this.LSWaitJoin = [];
                LocalData_WaitJoin.save(this.LSWaitJoin);
            }

        }
    })
    /**
    * @name 剪贴板 for dom
    */
    var clipboard = new ClipboardJS('.toCopy');

    clipboard.on('success', function (e) {
        console.log(e);
        app.updateToastAndShow('Copy', '✅Copied: ' + e.text);
    });

    clipboard.on('error', function (e) {
        console.log(e);
    });
</script>

</html>